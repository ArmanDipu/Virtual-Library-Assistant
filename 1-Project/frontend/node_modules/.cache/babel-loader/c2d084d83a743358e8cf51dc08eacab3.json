{"remainingRequest":"E:\\Projects\\vue-library-master\\1-Project\\frontend\\node_modules\\babel-loader\\lib\\index.js!E:\\Projects\\vue-library-master\\1-Project\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\Projects\\vue-library-master\\1-Project\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Projects\\vue-library-master\\1-Project\\frontend\\src\\shared\\form\\file-upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\Projects\\vue-library-master\\1-Project\\frontend\\src\\shared\\form\\file-upload.vue","mtime":1641838499549},{"path":"E:\\Projects\\vue-library-master\\1-Project\\frontend\\babel.config.js","mtime":1641838494433},{"path":"E:\\Projects\\vue-library-master\\1-Project\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1641838763341},{"path":"E:\\Projects\\vue-library-master\\1-Project\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1641838769328},{"path":"E:\\Projects\\vue-library-master\\1-Project\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1641838763341},{"path":"E:\\Projects\\vue-library-master\\1-Project\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1641838768457}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _toConsumableArray from \"E:\\\\Projects\\\\vue-library-master\\\\1-Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\toConsumableArray.js\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"E:\\\\Projects\\\\vue-library-master\\\\1-Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport _defineProperty from \"E:\\\\Projects\\\\vue-library-master\\\\1-Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\defineProperty.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { FileUploader } from '@/shared/file-upload/file-uploader';\nimport Errors from '@/shared/error/errors';\nexport default {\n  name: 'app-file-upload',\n  props: ['path', 'value', 'schema', 'max'],\n  data: function data() {\n    return {\n      fileList: (this.value || []).map(function (item) {\n        return _objectSpread(_objectSpread({}, item), {}, {\n          url: item.publicUrl\n        });\n      }),\n      loading: false\n    };\n  },\n  computed: {\n    isFull: function isFull() {\n      var hasInputReference = !!this.$refs.files;\n      return this.max && hasInputReference && this.$refs.files.uploadFiles.length >= this.max || !hasInputReference && (this.value || []).length >= this.max;\n    },\n    accept: function accept() {\n      return this.schema && this.schema.formats ? this.schema.formats.map(function (format) {\n        return \".\".concat(format);\n      }).join(',') : undefined;\n    }\n  },\n  methods: {\n    uploadFromRequest: function () {\n      var _uploadFromRequest = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(request) {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.loading = true;\n                return _context.abrupt(\"return\", FileUploader.uploadFromRequest(this.path, request, this.schema));\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function uploadFromRequest(_x) {\n        return _uploadFromRequest.apply(this, arguments);\n      }\n\n      return uploadFromRequest;\n    }(),\n    onSuccess: function onSuccess(file) {\n      if (!file) {\n        return;\n      }\n\n      this.$emit('input', [].concat(_toConsumableArray(this.value || []), [file]));\n      this.loading = false;\n    },\n    onError: function onError(error) {\n      Errors.showMessage(error);\n      this.loading = false;\n    },\n    onRemove: function onRemove(file, files) {\n      this.$emit('input', (this.value || []).filter(function (item) {\n        return files.some(function (file) {\n          return file.response ? file.response.id === item.id : file.id === item.id;\n        });\n      }));\n    },\n    download: function download(file) {\n      window.open(file.url, '_blank');\n    }\n  }\n};",{"version":3,"sources":["file-upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsBA,SAAA,YAAA,QAAA,oCAAA;AACA,OAAA,MAAA,MAAA,uBAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,iBADA;AAEA,EAAA,KAAA,EAAA,CAAA,MAAA,EAAA,OAAA,EAAA,QAAA,EAAA,KAAA,CAFA;AAIA,EAAA,IAJA,kBAIA;AACA,WAAA;AACA,MAAA,QAAA,EAAA,CAAA,KAAA,KAAA,IAAA,EAAA,EAAA,GAAA,CAAA,UAAA,IAAA;AAAA,+CACA,IADA;AAEA,UAAA,GAAA,EAAA,IAAA,CAAA;AAFA;AAAA,OAAA,CADA;AAKA,MAAA,OAAA,EAAA;AALA,KAAA;AAOA,GAZA;AAcA,EAAA,QAAA,EAAA;AACA,IAAA,MADA,oBACA;AACA,UAAA,iBAAA,GAAA,CAAA,CAAA,KAAA,KAAA,CAAA,KAAA;AAEA,aACA,KAAA,GAAA,IACA,iBAAA,IACA,KAAA,KAAA,CAAA,KAAA,CAAA,WAAA,CAAA,MAAA,IACA,KAAA,GAHA,IAIA,CAAA,iBAAA,IACA,CAAA,KAAA,KAAA,IAAA,EAAA,EAAA,MAAA,IAAA,KAAA,GANA;AAQA,KAZA;AAcA,IAAA,MAdA,oBAcA;AACA,aAAA,KAAA,MAAA,IAAA,KAAA,MAAA,CAAA,OAAA,GACA,KAAA,MAAA,CAAA,OAAA,CACA,GADA,CACA,UAAA,MAAA;AAAA,0BAAA,MAAA;AAAA,OADA,EAEA,IAFA,CAEA,GAFA,CADA,GAIA,SAJA;AAKA;AApBA,GAdA;AAqCA,EAAA,OAAA,EAAA;AACA,IAAA,iBADA;AAAA,wGACA,OADA;AAAA;AAAA;AAAA;AAAA;AAEA,qBAAA,OAAA,GAAA,IAAA;AAFA,iDAGA,YAAA,CAAA,iBAAA,CACA,KAAA,IADA,EAEA,OAFA,EAGA,KAAA,MAHA,CAHA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAUA,IAAA,SAVA,qBAUA,IAVA,EAUA;AACA,UAAA,CAAA,IAAA,EAAA;AACA;AACA;;AAEA,WAAA,KAAA,CAAA,OAAA,+BAAA,KAAA,KAAA,IAAA,EAAA,IAAA,IAAA;AACA,WAAA,OAAA,GAAA,KAAA;AACA,KAjBA;AAmBA,IAAA,OAnBA,mBAmBA,KAnBA,EAmBA;AACA,MAAA,MAAA,CAAA,WAAA,CAAA,KAAA;AACA,WAAA,OAAA,GAAA,KAAA;AACA,KAtBA;AAwBA,IAAA,QAxBA,oBAwBA,IAxBA,EAwBA,KAxBA,EAwBA;AACA,WAAA,KAAA,CACA,OADA,EAEA,CAAA,KAAA,KAAA,IAAA,EAAA,EAAA,MAAA,CAAA,UAAA,IAAA;AAAA,eACA,KAAA,CAAA,IAAA,CAAA,UAAA,IAAA;AAAA,iBACA,IAAA,CAAA,QAAA,GACA,IAAA,CAAA,QAAA,CAAA,EAAA,KAAA,IAAA,CAAA,EADA,GAEA,IAAA,CAAA,EAAA,KAAA,IAAA,CAAA,EAHA;AAAA,SAAA,CADA;AAAA,OAAA,CAFA;AAUA,KAnCA;AAqCA,IAAA,QArCA,oBAqCA,IArCA,EAqCA;AACA,MAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA,GAAA,EAAA,QAAA;AACA;AAvCA;AArCA,CAAA","sourcesContent":["<template>\n  <div>\n    <el-upload\n      :accept=\"accept\"\n      :file-list=\"fileList\"\n      :http-request=\"uploadFromRequest\"\n      :limit=\"max\"\n      :on-error=\"onError\"\n      :on-preview=\"download\"\n      :on-remove=\"onRemove\"\n      :on-success=\"onSuccess\"\n      action\n      ref=\"files\"\n    >\n      <el-button :disabled=\"loading || isFull\" size=\"small\" type=\"primary\">\n        <app-i18n code=\"fileUploader.upload\"></app-i18n>\n      </el-button>\n    </el-upload>\n  </div>\n</template>\n\n<script>\nimport { FileUploader } from '@/shared/file-upload/file-uploader';\nimport Errors from '@/shared/error/errors';\n\nexport default {\n  name: 'app-file-upload',\n  props: ['path', 'value', 'schema', 'max'],\n\n  data() {\n    return {\n      fileList: (this.value || []).map((item) => ({\n        ...item,\n        url: item.publicUrl,\n      })),\n      loading: false,\n    };\n  },\n\n  computed: {\n    isFull() {\n      const hasInputReference = !!this.$refs.files;\n\n      return (\n        (this.max &&\n          (hasInputReference &&\n            this.$refs.files.uploadFiles.length >=\n              this.max)) ||\n        (!hasInputReference &&\n          (this.value || []).length >= this.max)\n      );\n    },\n\n    accept() {\n      return this.schema && this.schema.formats\n        ? this.schema.formats\n            .map((format) => `.${format}`)\n            .join(',')\n        : undefined;\n    },\n  },\n\n  methods: {\n    async uploadFromRequest(request) {\n      this.loading = true;\n      return FileUploader.uploadFromRequest(\n        this.path,\n        request,\n        this.schema,\n      );\n    },\n\n    onSuccess(file) {\n      if (!file) {\n        return;\n      }\n\n      this.$emit('input', [...(this.value || []), file]);\n      this.loading = false;\n    },\n\n    onError(error) {\n      Errors.showMessage(error);\n      this.loading = false;\n    },\n\n    onRemove(file, files) {\n      this.$emit(\n        'input',\n        (this.value || []).filter((item) =>\n          files.some((file) =>\n            file.response\n              ? file.response.id === item.id\n              : file.id === item.id,\n          ),\n        ),\n      );\n    },\n\n    download(file) {\n      window.open(file.url, '_blank');\n    },\n  },\n};\n</script>\n"],"sourceRoot":"src/shared/form"}]}